VuNote
======

    Author:     <github.com/tintinweb>
    Ref:        https://github.com/tintinweb/pub/tree/master/pocs/cve-2017-18016
    Version:    0.1
    Date:       Jun 16th, 2017
    
    Tag:        parity same origin policy bypass webproxy token reuse

Overview
--------

    Name:           parity
    Vendor:         paritytech
    References:     * https://parity.io/ [1]
    
    Version:        1.6.8
    Latest Version: 1.7.11 (stable) - fixed
					1.8.5 (beta) - fixed
    Other Versions: <= 1.6.10 (stable) - vulnerable
    Platform(s):    cross
    Technology:     rust js

    Vuln Classes:   <TBD>
    Origin:         remote
    Min. Privs.:    ---

    CVE:            CVE-2017-18016



Description
---------

quote website [1]

>Parity Technologies is proud to present our powerful new Parity Browser. Integrated directly into your Web browser, Parity is the fastest and most secure way of interacting with the Ethereum network.


Summary 
-------

// (not yet published) PoC: https://tintinweb.github.io/pub/pocs/cve-2017-18016/

Ethereum Parity's built-in dapp/web-browsing functionality is (A) 
rendering browser same-origin policy (SOP) ineffective by proxying 
requests with the parity main process. As a result, any website 
navigated to ends up being origin http://localhost:8080. This also means
that all websites navigated to share the same origin and thus are not 
protected by the browser SOP allowing any proxied website/dapp to access
another proxied website/dapp's resources (Cookies, ...).

Worse, (B) the structure of proxy cache urls and the fact that they 
contain a reusable non-secret non-url specific cache-token it is 
possible for one proxied website/dapp to navigate to any other proxied
website/dapp gaining full script/XHR control due to (A) the SOP being
applied without any restrictions. This could allow a malicious
website/dapp to take control of another website/dapp, performing user
interactions, XHR or injecting scripts/DOM elements to mislead the
user or to cause other unspecified damage.


see attached PoC - index.html / PoC
    

Proof of Concept
----------------

Prerequisites: 

* (if hosted locally) modify /etc/hosts to resolve your testdomain to your webserver
* make `index.html` accessible on a webserver (e.g. `cd /path/to/index.html; python -m SimpleHTTPServer 80`)

1) launch parity, navigate to the built-in webbrowser (http://127.0.0.1:8180/#/web)
2) navigate the built-in parity webbrowser to where the PoC `index.html` is hosted
3) follow the instructions. 
3.1) Issue 1: navigate to some websites to have them set cookies, reload the PoC page and click "Get dom accessible cookies". Note that this attack is not restricted to dom accessible cookies
3.2) Issue 2: enter an url into the textbox and hit `Spawn SOP Iframe`. A new iframe will appear on the bottom of the page containing the proxied website. Note that the calling website has full script/dom/xhr access to the proxied target.
3.3) Demo 2: Just a PoC to find local web interfaces (e.g. your gateways web interface) and potentially mess with its configuration (i.e. critical DNS mitm)

//tested with latest chrome
 
Notes
-----

* Fix:  https://github.com/paritytech/parity/commit/53609f703e2f1af76441344ac3b72811c726a215 (first in 1.7.0)

References
----------

    [1] https://parity.io/
    [2] https://github.com/paritytech/parity/blame/e8b418ca03866fd952d456830b30e9225c81035a/dapps/src/web.rs


Contact
-------

    https://github.com/tintinweb
