<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="MistPwn dApp mist browser 'insecurities'">
    <meta name="author" content="github.com/tintinweb">
    <!--<link rel="icon" href="favicon.ico">-->

    <title>MistPwn dApp</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script>
    

      /**
       * Compare two software version numbers (e.g. 1.7.1)
       * Returns:
       *
       *  0 if they're identical
       *  negative if v1 < v2
       *  positive if v1 > v2
       *  Nan if they in the wrong format
       *
       *  E.g.:
       *
       *  assert(version_number_compare("1.7.1", "1.6.10") > 0);
       *  assert(version_number_compare("1.7.1", "1.7.10") < 0);
       *
       *  "Unit tests": http://jsfiddle.net/ripper234/Xv9WL/28/
       *
       *  Taken from http://stackoverflow.com/a/6832721/11236
       */
      function compareVersionNumbers(v1, v2){
          var v1parts = v1.split('.');
          var v2parts = v2.split('.');

          // First, validate both numbers are true version numbers
          function validateParts(parts) {
              for (var i = 0; i < parts.length; ++i) {
                  if (!isPositiveInteger(parts[i])) {
                      return false;
                  }
              }
              return true;
          }
          if (!validateParts(v1parts) || !validateParts(v2parts)) {
              return NaN;
          }

          for (var i = 0; i < v1parts.length; ++i) {
              if (v2parts.length === i) {
                  return 1;
              }

              if (v1parts[i] === v2parts[i]) {
                  continue;
              }
              if (v1parts[i] > v2parts[i]) {
                  return 1;
              }
              return -1;
          }

          if (v1parts.length != v2parts.length) {
              return -1;
          }

          return 0;
      }
      function isPositiveInteger(x) {
          // http://stackoverflow.com/a/1019526/11236
          return /^\d+$/.test(x);
      }

      function MistPwn(container_id) {
        console.debug("<MistPwn>");
        this.reference_url = "https://tintinweb.github.io/ether-mist"
        this.container = document.getElementById(container_id);
        this.result_table = document.getElementById("table-results");
        this.mist = (typeof mist == "undefined") ? false : mist;
        this.web3 = (typeof web3 == "undefined") ? false : web3;
        if (!this.mist)
            this.alertWarn("mist", "Please launch the Ethereum Mist Browser and navigate to <a href='"+window.location.href +"'><b>"+window.location.href+"</b></a>");
        if (!this.web3)
            this.alertWarn("web3", "Please launch a web3 enabled application and navigate to <a href='"+window.location.href +"'><b>"+window.location.href+"</b></a>");
        if (!this.mist && !this.web3){
          this.alertWarn("incompatible user-agent", "This user-agent is not supported (not mist nor web3 enabled API)");
        }
        that = this;
        console.debug("</MistPwn>");
      };
      MistPwn.prototype.alert = function(severity, title, message){
        div = document.createElement("div");
        div.className = "alert alert-" + severity;
        div.innerHTML = "<strong>"+title+"&nbsp;&nbsp;&nbsp;&nbsp;</strong>" + message;
        console.info(this.container);
        this.container.appendChild(div);
      };
      MistPwn.prototype.alertOk = function(title, message){
        this.alert("success", '<span class="glyphicon glyphicon-ok" aria-hidden="true" style="margin-right: 10px"></span>'+title, message);
      };
      MistPwn.prototype.alertFail = function(title, message){
        this.alert("danger", '<span class="glyphicon glyphicon-remove" aria-hidden="true" style="margin-right: 10px"></span>'+title, message);
      };
      MistPwn.prototype.alertWarn = function(title, message){
        this.alert("warning", '<span aria-hidden="true" style="margin-right: 10px">&#x26a0;</span>'+title, message);
      };
      MistPwn.prototype.addResult = function(status, vector, description, value){
        var tr = document.createElement("tr");
        var severity = {"notice":"default", 
                        "info":"primary", 
                        "pass":"success", 
                        "info":"info",
                        "info-disclosure":"info",
                        "warning":"warning",
                        "fail":"danger",
                        "danger":"danger"};
        if (Object.keys(severity).indexOf(status)>=0){
            status = '<span class="label label-'+severity[status]+'">'+status+'</span>';
        }
        else if(status=="a"){
            status = '<span class="label label-default">'+status+'</span>';
        }
        
        tr.innerHTML = "<td>"+(this.result_table.children.length+1)+"</td><td>"+status+"</td><td>"+vector+"</td><td>"+description+"</td><td>"+value+"</td>";
        this.result_table.appendChild(tr);
      };
      MistPwn.prototype.assertTrue = function(s, severity, vector, description, cb_value) {
        var ret = typeof s!="undefined" && !!s;
        if (ret)
          this.addResult("pass", vector, description, "...");
        else
          this.addResult(severity, vector, description, typeof cb_value=="function" ? cb_value() : '');
        return !!s;
      };
      MistPwn.prototype.assertFalse = function(s, severity, vector, description, cb_value) {
        var ret = typeof s=="undefined" || !s;
        if (ret)
          this.addResult("pass", vector, description, "...");
        else
          this.addResult(severity, vector, description, typeof cb_value=="function" ? cb_value() : '');
        return !s;
      };
      MistPwn.prototype.check = function(){
        console.info("<check>");

        alert("will be released on Oct. 1st");

        console.info("</check>")
      };
    </script>
  </head>

  <body>
    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">MistPwn dApp</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="#contact">Contact</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container theme-showcase" role="main">

      <!-- Main jumbotron for a primary marketing message or call to action -->
      <div class="jumbotron">
        <h1>MistPwn</h1>
        <p>An experimental dApp to demonstrate the need for per-dApp security policies for the Ethereum Mist...</p>
      </div>
      <div class="well">
        <p><b>... or why you should not navigate to untrusted sites with the mist browser...</b></p>
        Long story short, mist currently allows any website to ...
        <ul>
          <li>execute arbitrary shell commands on your machine (permissions of mist browser)</li>
          <li>delete arbitrary files and read/write/overwrite links to arbitrary locations</li>
          <li>get your main ethereum account and balance even though you are in anonymous (unconnected) mode revealing your identity without your consent</li>
          <li>enumerate local path, platform and infere your username revealing your identity in anonymous mode</li>
        </ul>
        Besides that, mist ...
        <ul>
          <li>does not warn you when connecting to insecure dapps/sites leaving you vulnerabler to MitM attacks (http allowed)</li>
          <li>does not protect known critical sites like wallet.ethereum.org with hsts/tls pinning</li>
          <li>does not warn you if you pin multiple dapps sharing the same name dapp name</li>
          <li>relies on a web-hosted default wallet that kind of is a single-point of exploitation to own all the ether users</li>
        </ul>
        and the wallet.ethereum.com dapp ...
        <ul>
          <li>does not protect from framing attacks (clickjacking)</li>
        </ul>
        Have your ethereum client tested, read the disclaimer and click the button if you agree.<br>
        The test is not performing any harmful operations. Pot. harmful operations like executing commands may require user interaction, see details.
      </div>
      <div class="well">
        <p>
        <b>Disclaimer</b>
        <pre>/* This program is free software. It comes without any warranty, to
 * the extent permitted by applicable law. You can redistribute it
 * and/or modify it under the terms of the GNU General Public License,
 * Version 2, as published by the Free Software Foundation. See
 * github.com/tintinweb/tintinweb.github.io for more details. */ </pre></p>
      </div>
      <p>
        <button type="button" class="btn btn-primary" onclick="mistpwn.check()">I agree!</button>
      </p>
      <!-- Scan results -->
      <div id="container-results">
      </div>
      <!-- Scan results -->
      <div class="page-header">
        <h1>Results</h1>
      </div>
      <div id="container-table-results">
        <table class="table table-striped">
            <thead>
              <tr>
                <th>#</th>
                <th>Status</th>
                <th>Vector</th>
                <th>Description</th>
                <th>Value</th>
              </tr>
            </thead>
            <tbody id="table-results">
            </tbody>
          </table>
      </div>

      <div class="page-header">
        <h1 id="contact">Contact</h1>
      </div>
      <div>
      <a href="https://github.com/tintinweb">//tintinweb</a>
      </div>
      <br/><br><br>
    </div> <!-- /container -->

  <!-- init MistPwn -->
  <script>
      console.debug("init");
      var mistpwn = new MistPwn('container-results');
  </script>

  </body>
</html>
