//Note: Details including PoC to this preliminary VuNote will be updated by Dec 5th.


Preliminary VuNote
===================

	Author:       <github.com/tintinweb>
	Ref:          https://github.com/tintinweb/pub/tree/master/pocs/tbd-2017-claymore-dual-miner
	Version:      0.1
	Date:         Nov 1st, 2017

	Tag:          claymore dual miner ethereum

Overview
--------

	Name:         Claymore's Dual ETH + DCR/SC/LBC/PASC GPU Miner
	Vendor:       nanopool/claymore
	References:   * https://github.com/nanopool/Claymore-Dual-Miner
	              * https://bitcointalk.org/index.php?topic=1433925.0

	Version:        10.1 [2]
	Latest Version: 10.1 [2]
	Other Versions: <= 10.1
	Platform(s):    windows, linux
	Technology:     C/C++

	Vuln Classes:   CWE-121: Stack-based Buffer Overflow
	                CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')
	Origin:         remote
	Min. Privs.:    None

	Source:         Closed; runtime protection mechanisms

	CVE:            DWF requested



Description
---------

A specialized mining solution with remote management interface for mining ethereum / decred / siacoin / LBRY Credits /
pascal coin.

quote website [1][2]

        - Supports new "dual mining" mode: mining both Ethereum and Decred/Siacoin/Lbry/Pascal at the same time, with no impact on Ethereum mining speed. Ethereum-only mining mode is supported as well.
        - Effective Ethereum mining speed is higher by 3-5% because of a completely different miner code - much less invalid and outdated shares, higher GPU load, optimized OpenCL code, optimized assembler kernels.
        - Supports both AMD and nVidia cards, even mixed.
        - No DAG files.
        - Supports all Stratum versions for Ethereum: can be used directly without any proxies with all pools that support eth-proxy, qtminer or miner-proxy.
        - Supports Ethereum and Siacoin solo mining.
        - Supports both HTTP and Stratum for Decred.
        - Supports both HTTP and Stratum for Siacoin. Note: not all Stratum versions are supported currently for Siacoin.
        - Supports Stratum for Lbry and Pascal.
        - Supports failover.
        - Displays detailed mining information and hashrate for every card.
        - Supports remote monitoring and management.
        - Supports GPU selection, built-in GPU overclocking features and temperature management.
        - Supports Ethereum forks (Expanse, etc).
        - Windows and Linux versions.

Summary
-------

<TBD>

1) RCE:
* unauthenticated
* remote
* stack buffer overwrite

conditions:
* remote management must be enabled: -mport <port>

Successful exploitation would likely allow an attacker to cause DoS, take over the blockchain mining node or execute
arbitrary code.

2) Path Traversal

conditions:
* authenticated
* write: not in readonly mode

Successful exploitation would allow an authenticated user to read/write arbitrary files (limited by procs permissions)


See attached PoC.

Details
-------

<TBD>


See attached PoC.

Proof of Concept
----------------

Prerequisites:
* compatible AMD/NVidia hardware


RCE:

1. start the miner, specify any pool and the readonly management port 3333 with a management password 123456

        #> EthDcrMiner64.exe -epool http://192.168.0.1:8545 -mport -3333

        +----------------------------------------------------------------+
        ¦     Claymore's Dual ETH + DCR/SC/LBC/PASC GPU Miner v10.0      ¦
        +----------------------------------------------------------------+

        ...
        Total cards: 1
        ETH - connecting to 192.168.0.1:8545
        DUAL MINING MODE ENABLED: ETHEREUM+DECRED
         DCR: Stratum - connecting to 'pasc-eu2.nanopool.org' <213.32.29.168> port 15555
        ETH: HTTP SOLO mode
        Ethereum HTTP requests time (-etht) is set to 200 ms
        Watchdog enabled
        Remote management (READ-ONLY MODE) is enabled on port 3333

         DCR: Stratum - Connected (pasc-eu2.nanopool.org:15555)
         DCR: Authorized
         DCR: 11/22/17-22:05:12 - New job from pasc-eu2.nanopool.org:15555

2. wait for it to initialize
3. run poc.py <TBD> localhost:3333

        #> poc.py 127.0.0.1:3333
        [poc.py -             <module>() ][    INFO] --start--
        [poc.py -             <module>() ][    INFO] # Claymore's Dual ETH + DCR/SC/LBC/PASC GPU Miner - Remote Buffer Overwrite
        [poc.py -             <module>() ][    INFO] # github.com/tintinweb
        [poc.py -         iter_targets() ][ WARNING] shodan apikey missing! shodan support disabled.
        [poc.py -             <module>() ][    INFO] [i] Target: 127.0.0.1:3333
        [poc.py -             <module>() ][    INFO] [+] connected.
        [poc.py -             <module>() ][    INFO] [+] peer disappeared. vulnerable!
        [poc.py -             <module>() ][ WARNING] error(10054, 'Eine vorhandene Verbindung wurde vom Remotehost geschlossen')
        [poc.py -             <module>() ][    INFO] --done--

<TBD>

WinDBG:

        !analyze -v -f

        *** wait with pending attach
        <...>
        Break-in sent, waiting 30 seconds...
        (12ec.262c): Access violation - code c0000005 (first chance)
        First chance exceptions are reported before any exception handling.
        This exception may be expected and handled.
        <...>
        EthDcrMiner64+0x5449f:
        00007ff6`42e9449f 8808            mov     byte ptr [rax],cl ds:00000059`b3b20000=??
        0:018> !analyze -v -f
        *******************************************************************************
        *                                                                             *
        *                        Exception Analysis                                   *
        *                                                                             *
        *******************************************************************************

       <...>

        FAULTING_IP:
        EthDcrMiner64+5449f
        00007ff6`42e9449f 8808            mov     byte ptr [rax],cl

        EXCEPTION_RECORD:  ffffffffffffffff -- (.exr 0xffffffffffffffff)
        ExceptionAddress: 00007ff642e9449f (EthDcrMiner64+0x000000000005449f)
           ExceptionCode: c0000005 (Access violation)
          ExceptionFlags: 00000000
        NumberParameters: 2
           Parameter[0]: 0000000000000001
           Parameter[1]: 00000059b3b20000
        Attempt to write to address 00000059b3b20000

        CONTEXT:  0000000000000000 -- (.cxr 0x0;r)
        rax=00000059b3b20000 rbx=00000059b3b179b0 rcx=00000212e75e1061
        rdx=00000059b3b17cb0 rsi=00000000000063bd rdi=00000059b3b179b0
        rip=00007ff642e9449f rsp=00000059b3b17900 rbp=00000059b3b17cb0
         r8=00000059b3b179b0  r9=00000059b3b179b0 r10=0000000000000000
        r11=0000000000000200 r12=00000000ffffffff r13=00000059b3b1fd98
        r14=00000212e75e9367 r15=0000000000000000
        iopl=0         nv up ei pl nz na po nc
        cs=0033  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010206
        EthDcrMiner64+0x5449f:
        00007ff6`42e9449f 8808            mov     byte ptr [rax],cl ds:00000059`b3b20000=??

        FAULTING_THREAD:  000000000000262c
        PROCESS_NAME:  EthDcrMiner64.exe
        ERROR_CODE: (NTSTATUS) 0xc0000005
        EXCEPTION_CODE: (NTSTATUS) 0xc0000005
        EXCEPTION_PARAMETER1:  0000000000000001
        EXCEPTION_PARAMETER2:  00000059b3b20000
        WRITE_ADDRESS:  00000059b3b20000
        FOLLOWUP_IP:
        EthDcrMiner64+5449f
        00007ff6`42e9449f 8808            mov     byte ptr [rax],cl

        NTGLOBALFLAG:  0
        APPLICATION_VERIFIER_FLAGS:  0
        APP:  ethdcrminer64.exe
        ANALYSIS_VERSION: 6.3.9600.16384 (debuggers(dbg).130821-1623) amd64fre
        BUGCHECK_STR:  APPLICATION_FAULT_INVALID_POINTER_WRITE_EXPLOITABLE
        PRIMARY_PROBLEM_CLASS:  INVALID_POINTER_WRITE_EXPLOITABLE
        DEFAULT_BUCKET_ID:  INVALID_POINTER_WRITE_EXPLOITABLE
        LAST_CONTROL_TRANSFER:  from 00007ff642e9456d to 00007ff642e9449f

        STACK_TEXT:
        00000059`b3b17900 00007ff6`42e9456d : 00007ff6`42ebc200 00007ff6`42e890d9 00007ff6`42ec87a0 00000212`e21cfbc0 : EthDcrMiner64+0x5449f
        00000059`b3b17930 00007ff6`42e941f4 : 00000212`e75e10c0 00000059`b3b17a70 00000000`ffff199b 00000000`00000000 : EthDcrMiner64+0x5456d
        00000059`b3b17970 00007ff6`42e875f0 : 00000000`00000000 00000000`00000000 00000059`b3b17d50 00000000`00000000 : EthDcrMiner64+0x541f4
        00000059`b3b17c90 00007ff6`42e4a633 : 00000000`00000002 00000212`e75e10c0 00000212`e75e10c0 00000000`000003d8 : EthDcrMiner64+0x475f0
        00000059`b3b17cf0 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : EthDcrMiner64+0xa633
        00000059`b3b1fd80 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fd88 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fd90 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fd98 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fda0 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fda8 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fdb0 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fdb8 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fdc0 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fdc8 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fdd0 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fdd8 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fde0 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fde8 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fdf0 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fdf8 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fe00 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fe08 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fe10 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fe18 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fe20 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fe28 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fe30 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fe38 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fe40 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fe48 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fe50 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fe58 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fe60 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fe68 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fe70 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fe78 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fe80 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fe88 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fe90 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fe98 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fea0 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fea8 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1feb0 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1feb8 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fec0 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fec8 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fed0 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fed8 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fee0 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fee8 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fef0 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1fef8 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ff00 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ff08 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ff10 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ff18 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ff20 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ff28 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ff30 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ff38 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ff40 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ff48 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ff50 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ff58 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ff60 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ff68 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ff70 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ff78 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ff80 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ff88 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ff90 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ff98 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ffa0 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ffa8 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ffb0 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ffb8 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ffc0 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ffc8 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ffd0 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ffd8 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 61616161`61616161 : 0x61616161`61616161
        00000059`b3b1ffe0 61616161`61616161 : 61616161`61616161 61616161`61616161 61616161`61616161 00000000`00000000 : 0x61616161`61616161
        00000059`b3b1ffe8 61616161`61616161 : 61616161`61616161 61616161`61616161 00000000`00000000 00000000`00000000 : 0x61616161`61616161
        00000059`b3b1fff0 61616161`61616161 : 61616161`61616161 00000000`00000000 00000000`00000000 00000000`00000000 : 0x61616161`61616161
        00000059`b3b1fff8 61616161`61616161 : 00000000`00000000 00000000`00000000 00000000`00000000 00000000`00000000 : 0x61616161`61616161
        00000059`b3b20000 00000000`00000000 : 00000000`00000000 00000000`00000000 00000000`00000000 00000000`00000000 : 0x61616161`61616161


        STACK_COMMAND:  .cxr 0x0 ; kb
        SYMBOL_STACK_INDEX:  0
        SYMBOL_NAME:  ethdcrminer64+5449f
        FOLLOWUP_NAME:  MachineOwner
        MODULE_NAME: EthDcrMiner64
        IMAGE_NAME:  EthDcrMiner64.exe
        DEBUG_FLR_IMAGE_TIMESTAMP:  59a94db0
        FAILURE_BUCKET_ID:  INVALID_POINTER_WRITE_EXPLOITABLE_c0000005_EthDcrMiner64.exe!Unknown
        BUCKET_ID:  APPLICATION_FAULT_INVALID_POINTER_WRITE_EXPLOITABLE_ethdcrminer64+5449f
        ANALYSIS_SOURCE:  UM
        FAILURE_ID_HASH_STRING:  um:invalid_pointer_write_exploitable_c0000005_ethdcrminer64.exe!unknown
        FAILURE_ID_HASH:  {08a7b27a-6079-b811-3504-3dff38b979e1}
        Followup: MachineOwner
        ---------


<TBD>
    ...

Patch
-----

    n/A - closed source

Notes
-----

* TBD


References
----------

	[1] https://github.com/nanopool/Claymore-Dual-Miner
	[2] https://bitcointalk.org/index.php?topic=1433925.0

Contact
-------

	https://github.com/tintinweb
